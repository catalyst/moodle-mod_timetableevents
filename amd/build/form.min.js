/**
 * JS for forms.
 *
 * @module    mod_timetableevents/form
 * @copyright 2022 onwards Catalyst IT EU {@link https://catalyst-eu.net}
 * @author    Sarah Cotton <sarah.cotton@catalyst-eu.net>
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
function remove_storage_keys(){localStorage.removeItem("tte_academicyear"),localStorage.removeItem("tte_term"),localStorage.removeItem("tte_teachingstartdate_day"),localStorage.removeItem("tte_teachingstartdate_month"),localStorage.removeItem("tte_teachingstartdate_year"),localStorage.removeItem("tte_firstsection"),localStorage.removeItem("tte_teachinginverval"),localStorage.removeItem("tte_readingweek"),localStorage.removeItem("tte_excluded"),localStorage.removeItem("tte_footertext")}define("mod_timetableevents/form",["core/ajax","core/str","jquery"],(function(ajax,str,$){return{course:function(course,sesskey){const terms=JSON.parse(document.querySelector('[name="termsjson"]').value),acadyear=document.getElementById("id_academicyear"),term=document.getElementById("id_term"),group=document.getElementById("id_groupoverrides"),group_selections=document.getElementById("groupoverrides_selections");var event=new Event("change",{bubbles:!0});if(acadyear.addEventListener("change",(function(){const yearid=document.getElementById("id_academicyear").value,year=terms[yearid];let list=[];for(const key in year)list[year[key].termid]=year[key].termname+" "+year[key].startdateformatted+" - "+year[key].enddateformatted;const id_term=document.getElementById("id_term");id_term.options.length=0;for(const key in list)id_term.options[id_term.options.length]=new Option(list[key],key);localStorage.getItem("tte_academicyear")||term.dispatchEvent(event)})),term.addEventListener("change",(function(){const year=document.getElementById("id_academicyear").value,startingtermid=document.getElementById("id_term").value;document.getElementById("id_teachingstartdate_day").value=parseInt(terms[year][startingtermid].day,10),document.getElementById("id_teachingstartdate_month").value=parseInt(terms[year][startingtermid].month,10),document.getElementById("id_teachingstartdate_year").value=terms[year][startingtermid].year})),group_selections&&group_selections.addEventListener("click",(function(e){let removegroup=e.target.getAttribute("data-value"),removegroupelement=e.target,removeoverrides=document.querySelector('[name="removeoverrides"]');removeoverrides.value=removeoverrides.value+","+removegroup,removegroupelement.style.display="none"})),group&&group.addEventListener("click",(function(){localStorage.setItem("tte_academicyear",document.getElementById("id_academicyear").value),localStorage.setItem("tte_term",document.getElementById("id_term").value),localStorage.setItem("tte_teachingstartdate_day",document.getElementById("id_teachingstartdate_day").value),localStorage.setItem("tte_teachingstartdate_month",document.getElementById("id_teachingstartdate_month").value),localStorage.setItem("tte_teachingstartdate_year",document.getElementById("id_teachingstartdate_year").value),localStorage.setItem("tte_firstsection",document.getElementById("id_firstsection").value),localStorage.setItem("tte_teachinginverval",document.getElementById("id_teachinginverval").value);const readingweek=document.getElementById("id_readingweek");localStorage.setItem("tte_readingweek",Array.from(readingweek.querySelectorAll("option:checked"),(v=>v.value)));const excluded=document.getElementById("id_excluded");localStorage.setItem("tte_excluded",Array.from(excluded.querySelectorAll("option:checked"),(v=>v.value))),localStorage.setItem("tte_footertext",document.getElementById("id_footertext").value);let year=document.getElementById("id_academicyear").value;location.href="/mod/timetableevents/group.php?id="+course+"&year="+year+"&sesskey="+sesskey})),localStorage.getItem("tte_academicyear")){document.getElementById("id_academicyear").value=localStorage.getItem("tte_academicyear"),acadyear.dispatchEvent(event),document.getElementById("id_term").value=localStorage.getItem("tte_term"),document.getElementById("id_teachingstartdate_day").value=localStorage.getItem("tte_teachingstartdate_day"),document.getElementById("id_teachingstartdate_month").value=localStorage.getItem("tte_teachingstartdate_month"),document.getElementById("id_teachingstartdate_year").value=localStorage.getItem("tte_teachingstartdate_year"),document.getElementById("id_firstsection").value=localStorage.getItem("tte_firstsection"),document.getElementById("id_teachinginverval").value=localStorage.getItem("tte_teachinginverval");const readingweek=document.getElementById("id_readingweek");for(let i=0;i<readingweek.options.length;i++)readingweek.options[i].selected=localStorage.getItem("tte_readingweek").indexOf(readingweek.options[i].value)>=0;var excluded=document.getElementById("id_excluded");for(let i=0;i<excluded.options.length;i++)excluded.options[i].selected=localStorage.getItem("tte_excluded").indexOf(excluded.options[i].value)>=0;document.getElementById("id_footertext").value=localStorage.getItem("tte_footertext"),remove_storage_keys()}},group:function(){const terms=JSON.parse(document.querySelector('[name="termsjson"]').value),term=document.getElementById("id_startingtermid");let hiddenyear=document.querySelector('[name="year"]').value;term.addEventListener("change",(function(){let startingtermid=document.getElementById("id_startingtermid").value;document.getElementById("id_teachingstartdate_day").value=parseInt(terms[hiddenyear][startingtermid].day,10),document.getElementById("id_teachingstartdate_month").value=parseInt(terms[hiddenyear][startingtermid].month,10),document.getElementById("id_teachingstartdate_year").value=terms[hiddenyear][startingtermid].year})),window.addEventListener("beforeunload",(function(){document.activeElement.href.includes("/mod/timetableevents/course.php")||remove_storage_keys()}))},instance:function(){const courseoverride=document.getElementById("id_courseoverride"),nogroups=str.get_string("modsetting:nogroups","timetableevents");courseoverride.addEventListener("change",(function(){let request={methodname:"mod_timetableevents_select_groups",args:{courseid:document.getElementById("id_courseoverride").value}};ajax.call([request])[0].then((function(value){const id_groupid=document.getElementById("id_groupid");if(id_groupid.options.length=0,value.length>0){for(const key in value)id_groupid.options[id_groupid.options.length]=new Option(value[key].name,value[key].id);id_groupid.disabled=!1}else $.when(nogroups).done((function(localizednogroups){id_groupid.options[id_groupid.options.length]=new Option(localizednogroups,0)})),id_groupid.disabled=!0}))}))}}}));

//# sourceMappingURL=form.min.js.map