{"version":3,"file":"form.min.js","sources":["../src/form.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JS for forms.\n *\n * @package   mod_timetableevents\n * @copyright 2022 onwards Catalyst IT EU {@link https://catalyst-eu.net}\n * @author    Sarah Cotton <sarah.cotton@catalyst-eu.net>\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([], function() {\n\n    return {\n        /**\n         * Initialize JS for forms.\n         * @access public\n         * @param {Object} params\n         */\n        course: function(course, sesskey) {\n            const terms = JSON.parse(document.querySelector('[name=\"termsjson\"]').value);\n            const acadyear = document.getElementById('id_academicyear');\n            const term = document.getElementById('id_term');\n            const group = document.getElementById('id_groupoverrides');\n            const group_selections = document.getElementById('groupoverrides_selections');\n\n            var event = new Event('change', { bubbles: true });\n\n            acadyear.addEventListener('change',function(){\n                /* eslint-disable no-console */\n                console.log(terms);\n                /* eslint-enable no-console */\n                const yearid = document.getElementById(\"id_academicyear\").value;\n                const year = terms[yearid];\n                let list = [];\n\n                // Construct new options list for selected year.\n                for (const key in year) {\n                    list[year[key].termid] = year[key].termname + ' ' + year[key].startdateformatted\n                            + ' - ' + year[key].enddateformatted;\n                }\n\n                // Remove current options from select.\n                const id_term = document.getElementById(\"id_term\");\n                id_term.options.length = 0;\n\n                // Replace select options.\n                for (const key in list) {\n                    id_term.options[id_term.options.length] = new Option(list[key], key);\n                }\n\n                // Trigger update of term start date.\n                if (!localStorage.getItem('tte_academicyear')) {\n                    term.dispatchEvent(event);\n                }\n\n            });\n\n            term.addEventListener('change',function(){\n                const year = document.getElementById('id_academicyear').value;\n                const startingtermid = document.getElementById('id_term').value;\n\n                document.getElementById('id_teachingstartdate_day').value = parseInt(terms[year][startingtermid]['day'], 10);\n                document.getElementById('id_teachingstartdate_month').value = parseInt(terms[year][startingtermid]['month'], 10);\n                document.getElementById('id_teachingstartdate_year').value = terms[year][startingtermid]['year'];\n\n            });\n\n            group_selections.addEventListener('click',function(e){\n                // Get value of clicked element and add to hidden element\n                // to pass back to the form.\n                let removegroup = e.target.getAttribute('data-value');\n                let removegroupelement = e.target;\n                let removeoverrides = document.querySelector('[name=\"removeoverrides\"]');\n                removeoverrides.value = removeoverrides.value + ',' + removegroup;\n\n                // Hide element.\n                removegroupelement.style.display = \"none\";\n            });\n\n            group.addEventListener('click',function(){\n\n                // Save currently set data to Web Storage API.\n                localStorage.setItem('tte_academicyear', document.getElementById('id_academicyear').value);\n                localStorage.setItem('tte_term', document.getElementById('id_term').value);\n                localStorage.setItem('tte_teachingstartdate_day', document.getElementById('id_teachingstartdate_day').value);\n                localStorage.setItem('tte_teachingstartdate_month', document.getElementById('id_teachingstartdate_month').value);\n                localStorage.setItem('tte_teachingstartdate_year', document.getElementById('id_teachingstartdate_year').value);\n                localStorage.setItem('tte_firstsection', document.getElementById('id_firstsection').value);\n                localStorage.setItem('tte_teachinginverval', document.getElementById('id_teachinginverval').value);\n\n                const readingweek = document.getElementById('id_readingweek');\n                localStorage.setItem('tte_readingweek', Array.from(readingweek.querySelectorAll(\"option:checked\"),v => v.value));\n\n                const excluded = document.getElementById('id_excluded');\n                localStorage.setItem('tte_excluded', Array.from(excluded.querySelectorAll(\"option:checked\"),v => v.value));\n                localStorage.setItem('tte_footertext', document.getElementById('id_footertext').value);\n\n                // Redirect user to group overrides settings.\n                let year = document.getElementById('id_academicyear').value;\n                location.href = '/mod/timetableevents/group.php?id=' + course + '&year=' + year + '&sesskey=' + sesskey;\n            });\n\n            // Check if Web Storage data has been set and load if present.\n            if (localStorage.getItem('tte_academicyear')) {\n\n                document.getElementById('id_academicyear').value = localStorage.getItem('tte_academicyear');\n                // Trigger the acad year event so we have data for the correct year in the term dropdown.\n                acadyear.dispatchEvent(event);\n                document.getElementById('id_term').value = localStorage.getItem('tte_term');\n                document.getElementById('id_teachingstartdate_day').value = localStorage.getItem('tte_teachingstartdate_day');\n                document.getElementById('id_teachingstartdate_month').value = localStorage.getItem('tte_teachingstartdate_month');\n                document.getElementById('id_teachingstartdate_year').value = localStorage.getItem('tte_teachingstartdate_year');\n                document.getElementById('id_firstsection').value = localStorage.getItem('tte_firstsection');\n                document.getElementById('id_teachinginverval').value = localStorage.getItem('tte_teachinginverval');\n\n                const readingweek = document.getElementById('id_readingweek');\n                for (let i = 0; i < readingweek.options.length; i++) {\n                    readingweek.options[i].selected =\n                        localStorage.getItem('tte_readingweek').indexOf(readingweek.options[i].value) >= 0;\n                }\n\n                var excluded = document.getElementById('id_excluded');\n                for (let i = 0; i < excluded.options.length; i++) {\n                    excluded.options[i].selected = localStorage.getItem('tte_excluded').indexOf(excluded.options[i].value) >= 0;\n                }\n                document.getElementById('id_footertext').value = localStorage.getItem('tte_footertext');\n\n                remove_storage_keys();\n\n            }\n        },\n\n        group: function() {\n            const terms = JSON.parse(document.querySelector('[name=\"termsjson\"]').value);\n            const term = document.getElementById('id_startingtermid');\n            let hiddenyear = document.querySelector('[name=\"year\"]').value;\n\n            term.addEventListener('change',function(){\n                let startingtermid = document.getElementById('id_startingtermid').value;\n\n                document.getElementById('id_teachingstartdate_day').value = parseInt(terms[hiddenyear][startingtermid]['day'], 10);\n                document.getElementById('id_teachingstartdate_month').value =\n                    parseInt(terms[hiddenyear][startingtermid]['month'], 10);\n                document.getElementById('id_teachingstartdate_year').value = terms[hiddenyear][startingtermid]['year'];\n\n            });\n\n            window.addEventListener('beforeunload', function() {\n                let url = document.activeElement.href;\n                // If we're moving away from the course settings page without saving, remove the storage keys.\n                if (!url.includes('/mod/timetableevents/course.php')) {\n                    remove_storage_keys();\n                }\n            });\n        }\n    };\n});\n\nfunction remove_storage_keys() {\n    localStorage.removeItem('tte_academicyear');\n    localStorage.removeItem('tte_term');\n    localStorage.removeItem('tte_teachingstartdate_day');\n    localStorage.removeItem('tte_teachingstartdate_month');\n    localStorage.removeItem('tte_teachingstartdate_year');\n    localStorage.removeItem('tte_firstsection');\n    localStorage.removeItem('tte_teachinginverval');\n    localStorage.removeItem('tte_readingweek');\n    localStorage.removeItem('tte_excluded');\n    localStorage.removeItem('tte_footertext');\n}\n"],"names":["remove_storage_keys","localStorage","removeItem","define","course","sesskey","terms","JSON","parse","document","querySelector","value","acadyear","getElementById","term","group","group_selections","event","Event","bubbles","addEventListener","console","log","yearid","year","list","key","termid","termname","startdateformatted","enddateformatted","id_term","options","length","Option","getItem","dispatchEvent","startingtermid","parseInt","e","removegroup","target","getAttribute","removegroupelement","removeoverrides","style","display","setItem","readingweek","Array","from","querySelectorAll","v","excluded","location","href","i","selected","indexOf","hiddenyear","window","activeElement","includes"],"mappings":"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"}